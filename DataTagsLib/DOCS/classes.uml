@startuml

package model {
	class DataTags {
		composeWith( t:DataTags ): DataTags
	}

	package types {
		class TagType {
			+ name:String
			+ info:String
		}

		class ToDoType {
			
		}

		class SimpleType {
			+ values: TagValue[]
		}

		class AggregateType {
			+ itemType: TagType
		}

		class CompoundType {
			+ fields: List<TagType>
		}
	}
	package values {
		class TagValue {
			+ name: String
			+ type: TagType
			+ info: String
		}

		class SimpleValue <<Comparable>> {
			+ ordinal: int
		}

		class ToDoValue {
			
		}

		class AggregateValue {
			values: TagValue[]
		}

		class CompoundValue {
			values: Map<TagType<TagValue>,TagValue>
		}
	}
}

package runtime {
	class RuntimeEngine {
		+ currentTags : DataTags
		+ nodeStack: Stack<DecisionNode>
		getState() : state
		restoreState( state )
		consume( ans:Answer )
	}

	class RuntimeEntity {
		+ id : String
		+ title : String
		+ info  : String
	}

	class FlowChartSet {
		+ source : URL
		+ charts : FlowChart[]
		+ tagTypes : TagType[]
	}

	class FlowChart {
		+ source : URL
		+ start  : DecisionNode
		+ nodes  : DecisionNode[]
	}

	class Node {
		+ chart : FlowChart
		+ dataTags : DataTags
	}

	class DecisionNode {
		+ yes : DecisionNode
		+ no  : DecisionNode
	}

	class CallNode {
		+ calleeChartId : String
		+ calleeNodeId  : String
		+ nextNode : Node
	}

	class EndNode

	enum Answer {
		YES
		NO
	}
}

RuntimeEngine --> DataTags : currentTags
RuntimeEngine --> "1..*" Node : nodeStack

RuntimeEngine --> FlowChartSet : chartSet
note on link
	The program executed
	by the runtime 
end note
RuntimeEntity <|-- Node
RuntimeEntity <|-- FlowChart
RuntimeEntity <|-- FlowChartSet
Node <|-- DecisionNode
Node <|-- CallNode
Node <|-- EndNode
TagType <|-- ToDoType
TagType <|-- SimpleType
TagType <|-- AggregateType
TagType <|-- CompoundType

TagValue <|-- ToDoValue
TagValue <|-- AggregateValue
TagValue <|-- CompoundValue
TagValue <|-- SimpleValue

CompoundValue <|-- DataTags

FlowChartSet "1" --> "1..*" FlowChart : charts
note on link: Mapped by name

FlowChart --> Node : start
CallNode --> Node : nextNode

DecisionNode --> Node: YES
DecisionNode --> Node: NO
DecisionNode --> FlowChart : chart
DecisionNode --> DataTags : assumption

DataTags "1" --> "1" CompoundType

AggregateValue ---> "0..*" SimpleValue : items

AggregateType --> SimpleType : itemType

CompoundType --> "0..*" TagType : fieldTypes

CompoundValue --> "0..*" TagValue : fieldValues

FlowChartSet --> "0..*" TagType : tagTypes

TagValue --> TagType : type

@enduml